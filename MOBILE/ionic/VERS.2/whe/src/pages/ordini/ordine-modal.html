<ion-header>
  <ion-navbar color="primary">
    <ion-title>Ordine</ion-title>

    <ion-buttons end>
      <button ion-button icon-only (click)="dismiss()">
        <ion-icon ios="ios-close" md="md-close"></ion-icon>
      </button>
    </ion-buttons>

  </ion-navbar>
</ion-header>

<ion-content>
	
    <!-- CREATE: Client and Products -->
    <ion-list *ngIf="sectionCreate">
      <ion-item>
        <ion-label>Cliente *</ion-label>
        <ion-select [(ngModel)]="selectedUser" cancelText="Chiudi" okText="Scegli cliente" required>
          <ion-option *ngFor="let cust of customer" [value]="cust">{{cust.display_name}}</ion-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label>Prodotti *</ion-label>
        <ion-select [(ngModel)]="selectedProducts" multiple="true" cancelText="Chiudi" okText="Scegli prodotti"required>
          <ion-option *ngFor="let prod of line_items" [value]="prod">{{prod.title}}</ion-option>
        </ion-select>
      </ion-item>
    </ion-list>
    <button *ngIf="sectionCreate" ion-button large full color="dark" (click)="orderStepAddQuantity()">Avanti</button>

    <!-- CREATE: Products Quantity -->
    <ion-list *ngIf="sectionSelectQuantity">
      <ion-item *ngFor="let prod of selectedProductsQnt">
        <ion-label>
          {{prod.prodTitle}}
        </ion-label>
        <ion-input type="number" name="prodAddQuantity" [(ngModel)]="prod.prodAddQuantity"></ion-input>
        <ion-note item-right>
          <em>{{prod.prodQuantity}}</em>
        </ion-note>
      </ion-item>
    </ion-list>
    <button *ngIf="sectionSelectQuantity" ion-button large full color="dark" (click)="orderStepSummary()">Riepilogo</button>

    <!-- CREATE: Summary -->
    <ion-list *ngIf="sectionSummary">
      <ion-item>
        <p>Cliente</p>
        <h2>{{selectedUser.display_name}}</h2>
      </ion-item>

      <ion-item *ngFor="let prod of selectedProductsQnt">
        <h2>{{prod.prodAddQuantity}} x {{prod.prodTitle}}</h2>
        <ion-note item-right>
          <em>&euro; {{prod.prodAddQuantity * prod.prodPrice}}</em>
        </ion-note>
      </ion-item>
    </ion-list>
    <button *ngIf="sectionSummary" ion-button large full color="dark" (click)="orderComplete()">Completa</button>

    <!-- DETAIL: ... -->
    <ion-list *ngIf="sectionDetail">

      <ion-item>
        <h3>Ordine num. <strong>{{ordine.order_number}}</strong> in stato <strong>{{ordine.status}}</strong></h3> 
      </ion-item>

      <ion-item>
        <p>Cliente</p>
        <h2>{{ordine.customer.first_name}} {{ordine.customer.last_name}}</h2>
      </ion-item>

      <ion-item>
        <p>Eseguito il</p>
        <h2>{{ordine.created_at | date: 'dd/MM/yyyy HH:mm'}}</h2>
      </ion-item>

      <ion-item>
        <p>Totale</p>
        <h2>{{ordine.total}}</h2>
      </ion-item>

      <ion-item>
        <p>Tasse</p>
        <h2>{{ordine.total_tax}}</h2>
      </ion-item>

      <ion-item>
        <p>Prodotti</p>
        <h3><strong>{{ordine.total_line_items_quantity}}</strong> prodotto/i acquistato/i</h3>
      </ion-item>

      <ion-item *ngFor="let prod of line_items">
        <h2>{{prod.quantity}} x {{prod.name}}</h2>
        <ion-note item-right>
          <em>&euro; {{prod.quantity * prod.price}}</em>
        </ion-note>
      </ion-item>

      <ion-item>
        <p>Note</p>
        <h2><strong>{{ordine.note}}</strong></h2>
      </ion-item>

    </ion-list>

    <div *ngIf="showButtonEditDelete">
      <ion-fab right bottom fab-fixed>
        <button ion-fab color="dark"><ion-icon name="ios-arrow-back"></ion-icon></button>
        <ion-fab-list side="left">
          <button ion-fab color="dark" (click)="sendMail(ordine.customer.email)"><ion-icon name="mail"></ion-icon></button>
          <button ion-fab color="dark" (click)="changeStatus(ordine,ordine.status)"><ion-icon name="swap"></ion-icon></button>
          <button ion-fab color="dark" (click)="deleteOrder(ordine.id)"><ion-icon name="trash"></ion-icon></button>
          <button ion-fab color="dark" (click)="showNote(ordine.id)"><ion-icon name="paper"></ion-icon></button>
        </ion-fab-list>
      </ion-fab>
  </div>


</ion-content>